box: node:6.9.1
build:
  steps:
    - npm-install
    - script:
        name: Run unit tests
        code: |
          npm run test
    
deploy:
  steps:
    - heroku-deploy:
        key: $HEROKU_KEY
        key-name: DEPLOY_KEY
        user: $HEROKU_USER
        app-name: $HEROKU_APP_NAME
dpush:
  steps:
    - internal/docker-push:
        username: tannaalok
        password: Acs@dm1n
        repository: tannaalok/wnode
        cmd: /bin/bash -c “cd /pipeline/source && supervisor — watch ./src src/server.js”


deploydo:
   steps:
     - add-ssh-key:
         keyname: digitalocean
     - add-to-known_hosts:
         hostname: 107.170.73.20
     - script:
         name: pull latest image
         code: ssh root@107.170.73.20 docker pull tannaalok/wnode:latest
     - script:
         name: run new container
         code: ssh root@107.170.73.20 docker run -d -p 8080:80 --name wnode tannaalok/wnode
